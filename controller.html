<!-- 
    author: GOH
    version: x.x.x
    VCS: git    
    modified: 1103 9/7/19
-->
<html>

<head>
    <!-- library -->
    <script type="text/javascript" src="https://ajax.microsoft.com/ajax/jQuery/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="http://signage.me/demo/sendCommand.js"></script>
</head>

<div style="color:rgb(4, 155, 79);max-width:700px;text-align:center;margin:auto;">
    <!-- javascript -->

    <script type="text/javascript">
        var team1_score = 0;
        var team2_score = 0;
        var SID = "11";
        var EMAIL = "support@scotwell";
        var PASSWORD = "Scotwell123";
        var i;
        $(document).ready(function () {
            var $jsTeam1 = document.querySelector(".team1");
            var $jsTeam2 = document.querySelector(".team2");
            var $jsTeamAValue = document.querySelector(".jsTeamAValue");
            var $jsTeamBValue = document.querySelector(".jsTeamBValue");

            //instantly display on screen
            $jsTeam1.addEventListener(
                "input",
                function (event) {
                    $jsTeamAValue.innerHTML = $jsTeam1.value;
                },
                false
            );
            $jsTeam2.addEventListener(
                "input",
                function (event) {
                    $jsTeamBValue.innerHTML = $jsTeam2.value;
                },
                false
            );
            btnStart.addEventListener("click", function () {
                //buffer();
                i = setInterval(buffer().step, 1000);
            });
            
            btnStop.addEventListener("click", function () {
                clearInterval(i);
                //setInterval(buffer().step, 1000);
            });

            btnClear.addEventListener("click", function () {
                seconds = -1;
                total_time = 0;
                document.getElementById("count").innerHTML = "0:0";
            });

            btnADDTEAM_A.addEventListener("click", function () {
                team1_score++;
                document.getElementById("team1_score").innerHTML = team1_score;
                sendCommand(
                    "galaxy.signage.me",
                    EMAIL,
                    PASSWORD,
                    SID,
                    "scoreA_rec",
                    team1_score
                );
            });
            btnADDTEAM_B.addEventListener("click", function () {
                team2_score++;
                document.getElementById("team2_score").innerHTML = team2_score;
                sendCommand(
                    "galaxy.signage.me",
                    EMAIL,
                    PASSWORD,
                    SID,
                    "scoreB_rec",
                    team2_score
                );
            });
            btnSUBTEAM_A.addEventListener("click", function () {
                team1_score--;
                document.getElementById("team1_score").innerHTML = team1_score;
                sendCommand(
                    "galaxy.signage.me",
                    EMAIL,
                    PASSWORD,
                    SID,
                    "scoreA_rec",
                    team1_score
                );
            });
            btnSUBTEAM_B.addEventListener("click", function () {
                team2_score--;
                document.getElementById("team2_score").innerHTML = team2_score;
                sendCommand(
                    "galaxy.signage.me",
                    EMAIL,
                    PASSWORD,
                    SID,
                    "scoreB_rec",
                    team2_score
                );
            });

            //clicks will instantly sent data to signage player
            //format : server,email,password,station id,receive event name,return value
            $("#btnREFRESH").click(function () {
                sendCommand(
                    "galaxy.signage.me",
                    EMAIL,
                    PASSWORD,
                    SID,
                    "title_rec",
                    document.INFO_INPUT.title.value
                );
                sendCommand(
                    "galaxy.signage.me",
                    EMAIL,
                    PASSWORD,
                    SID,
                    "special_rec",
                    document.INFO_INPUT.special.value
                );
                sendCommand(
                    "galaxy.signage.me",
                    EMAIL,
                    PASSWORD,
                    SID,
                    "team1_rec",
                    document.INFO_INPUT.team1_name.value
                );
                sendCommand(
                    "galaxy.signage.me",
                    EMAIL,
                    PASSWORD,
                    SID,
                    "team2_rec",
                    document.INFO_INPUT.team2_name.value
                );
            });
        });




        function buffer() {






            /////timer
            var interval = 1000; // ms
            var expected = Date.now() + interval;

            var drift_history = [];
            var drift_history_samples = 10;
            var drift_correction = 0;
            var seconds = 0,
                minutes = 0,
                total_time = 0;

            function calc_drift(arr) {
                // Calculate drift correction.

                var values = arr.concat(); // copy array so it isn't mutated

                values.sort(function (a, b) {
                    return a - b;
                });
                if (values.length === 0) return 0;
                var half = Math.floor(values.length / 2);
                if (values.length % 2) return values[half];
                var median = (values[half - 1] + values[half]) / 2.0;

                return median;
            }

            setTimeout(step, interval);

            function step() {
                var dt = Date.now() - expected; // the drift (positive for overshooting)


                if (dt > interval) {
                    // something really bad happened. Maybe the browser (tab) was inactive?
                    // possibly special handling to avoid futile "catch up" run
                }

                /////////////////////////////////////////////////////
                // do what is to be done
                seconds++;
                if (seconds >= 60) {
                    seconds = 0;
                    minutes++;
                }

                total_time = (minutes + ":" + seconds);

                document.getElementById("count").innerHTML = (minutes + ":" + seconds);
                sendCommand(
                    "galaxy.signage.me",
                    EMAIL,
                    PASSWORD,
                    SID,
                    "minutes_rec",
                    total_time
                );

                /////////////////////////////////////////////////////

                // don't update the history for exceptionally large values
                if (dt <= interval) {
                    // sample drift amount to history after removing current correction
                    // (add to remove because the correction is applied by subtraction)
                    drift_history.push(dt + drift_correction);

                    // predict new drift correction
                    drift_correction = calc_drift(drift_history);

                    // cap and refresh samples
                    if (drift_history.length >= drift_history_samples) {
                        drift_history.shift();
                    }
                }

                expected += interval;
                // take into account drift with prediction
                setTimeout(step, Math.max(0, interval - dt - drift_correction));
            }
            /////end of timer
        }
    </script>








    <body>

        <title>Controller</title>
        <h1>Scotwell</h1>
        <!-- user input form -->
        <FORM NAME="INFO_INPUT" style="text-align: center;">
            <fieldset>
                <legend>Scoreboard Controller</legend>
                Title:<input type="text" name="title" placeholder="Event Name" /><br />
                Special:<input type="text" name="special" placeholder="Special Message" /><br />
                TEAM 1:<input class="team1" type="text" name="team1_name" placeholder="Team 1 Name" /><br />
                TEAM 2:<input class="team2" type="text" name="team2_name" placeholder="Team 2 Name" /><br /><br />
                <button id="btnREFRESH" style="width:80px;height:30" type="button">Upload</button><br />
            </fieldset>
        </FORM>


        <button id="btnStart" onClick=" btnStart.disabled = true; btnStop.disabled = false;">START</button>
        <button id="btnStop" onClick="  btnStart.disabled = false;">PAUSE</button>
        <button id="btnClear"
            onClick=" btnStop.disabled = true; btnStart.disabled = false;">RESET</button><br /><br /><br />

        <span id="count" class="bordered">0:0</span><br /><br />


        <!-- table css editor -->
        <style type="text/css">
            fieldset {
                font-size: 20px;
                font-weight: 700;
                padding: 10px;
                width: 250px;
                line-height: 30px;
                margin: auto;
            }

            .bordered {
                font-family: Arial, sans-serif;
                font-size: 30px;
                font-weight: 900;
                width: 200px;
                height: 5px;
                padding: 10px;
                border: 10px double rgb(205, 50, 50);
                border-radius: 8px;
            }

            .tg {
                border-collapse: collapse;
                border-spacing: 10;
                margin: auto;
            }

            .tg td {
                font-family: Arial, sans-serif;
                font-size: 30px;
                font-weight: 900;
                padding: 5px 5px;
                border-style: solid;
                border-width: 1px;
                overflow: hidden;
                word-break: normal;
                border-color: rgb(0, 0, 0);
            }

            .tg th {
                font-family: Arial, sans-serif;
                font-size: 30px;
                font-weight: 900;
                padding: 10px;
                border-style: solid;
                border-width: 1px;
                overflow: hidden;
                word-break: normal;
                border-color: rgb(0, 0, 0);
            }

            .tg .tg-iq9e {
                font-size: 20px;
                border-color: rgba(0, 0, 0, 0);
                text-align: center;
            }
        </style>



        <table class="tg">
            <tr>
                <th class="tg-iq9e">
                    <h2><span class="jsTeamAValue">Team A</span></h2>
                </th>
                <th class="tg-iq9e">vs</th>
                <th class="tg-iq9e">
                    <h2><span class="jsTeamBValue">Team B</span></h2>
                </th>
            </tr>
            <tr>
                <td class="tg-iq9e">
                    <button id="btnADDTEAM_A" style="width:100px;height:40">
                        +
                    </button>
                </td>
                <td class="tg-iq9e"></td>
                <td class="tg-iq9e">
                    <button id="btnADDTEAM_B" style="width:100px;height:40">
                        +
                    </button>
                </td>
            </tr>
            <tr>
                <!-- will add displaying current score function -->
                <td class="tg-iq9e">
                    <h1> <span id="team1_score">0</span> </h1>
                </td>
                <td class="tg-iq9e"></td>
                <td class="tg-iq9e">
                    <h1> <span id="team2_score">0</span> </h1>
                </td>
            </tr>
            <tr>
                <td class="tg-iq9e">
                    <button id="btnSUBTEAM_A" style="width:100px;height:40">
                        -
                    </button>
                </td>
                <td class="tg-iq9e"></td>
                <td class="tg-iq9e">
                    <button id="btnSUBTEAM_B" style="width:100px;height:40">
                        -
                    </button>
                </td>
            </tr>
        </table>
    </body>
</div>

</html>
